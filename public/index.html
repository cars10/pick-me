<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="ie=edge" http-equiv="X-UA-Compatible">
  <title>PickMe</title>
  <style>
      * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
      }

      body {
          font-family: sans-serif;
          margin: 10px auto;
          border-bottom: 2px solid grey;
      }

      .container {
          width: 50%;
          margin: auto;
      }

      .card {
          background-color: #eee;
          border: 1px solid #ccc;
          border-radius: 2px;
          padding: 18px 20px;
          box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
          margin-bottom: 20px;
      }

      .form-group {
          margin-top: 10px;
          margin-bottom: 10px;
      }

      h2 {
          margin-top: 14px;
          margin-bottom: 14px;
      }

      .w-50 {
          width: 50%;
      }

      .flex {
          display: flex;
      }

      table {
          border-collapse: collapse;
      }

      table, th, td {
          border: 1px solid #aaa;
      }

      table th, table td {
          padding: 6px 12px;
          text-align: left;
      }
  </style>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
<div class="container">
  <h1>Demo</h1>

  <div class="card">
    <div class="flex">
      <div class="w-50">
        <h2>Settings</h2>

        <div id="settings">
          <div class="form-group">
            <label for="set_language">Language</label>
            <select class="form-control" id="set_language">
              <option selected value="de">German</option>
              <option value="en">English</option>
            </select>
          </div>

          <div class="form-group">
            <label for="set_selected_text_format">Selected text format</label>
            <input class="form-control" id="set_selected_text_format" value="count>2">
          </div>

          <div class="form-group">
            <div class="checkbox">
              <label for="set_dropdown_align_right">
                <input id="set_dropdown_align_right" type="checkbox"> Align dropdown right
              </label>
            </div>
          </div>

          <div class="form-group">
            <div class="checkbox">
              <label for="set_disabled">
                <input id="set_disabled" type="checkbox"> Disable select
              </label>
            </div>
          </div>

          <div class="form-group">
            <div class="checkbox">
              <label for="search_option">
                <input id="search_option" type="checkbox"> Enable search
              </label>
            </div>
          </div>

          <div class="form-group">
            <div class="checkbox">
              <label for="multiple">
                <input id="multiple" type="checkbox"> Multiple
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="w-50">
        <h2>Debug information</h2>
        <table class="table">
          <tr>
            <th># Entries</th>
            <th>Value</th>
          </tr>
          <tr>
            <td id="amount">0</td>
            <td id="value"></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <h2>Output</h2>
  <div class="row" style="margin-bottom: 400px;">
    <div class="col-sm-4 col-sm-offset-2">
      <form>
        <button type="button" id="reset-form">Reset</button>
        <select id="picker" name="picker" title="Select something"> </select>
      </form>
    </div>
  </div>
</div>

<script src="./dist/main.js"></script>
<script>
  const selectId = 'picker'

  const userData = {
    'Manager': [
      { value: 1, text: 'Anna Müller', subtext: 'awesome', img: { src: 'https://picsum.photos/24?a=1' } },
      { value: 2, text: 'Jim Knopf', subtext: 'cool', img: { src: 'https://picsum.photos/24?a=2' } },
      {
        value: "{&quot;UserMailer&quot;:&quot;notify_about_survey&quot;}",
        text: 'Max Mustermann',
        img: { src: 'https://picsum.photos/24?a=3' },
        selected: true
      },
    ],
    'Praktikanten': [
      { value: 13, text: 'Günther Jauch', img: { src: "https://picsum.photos/24?a=13" } },
      { value: 17, text: 'Thomas Gottschalk', subtext: 'stylisch', img: { src: "https://picsum.photos/24?a=17" } }
    ]
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupSelect(userData, true)
    reload()
  })
  document.getElementById('reset-form').addEventListener('click', function (e) {
    e.target.form.reset()
    debugHandler(window.PickMe.elements[selectId])
    console.log(document.getElementById(selectId).value)
  })

  Array.apply(null, document.getElementById('settings').querySelectorAll('input,select')).forEach(function (input) {
    input.addEventListener('input', function () {
      window.PickMe.elements[selectId].destroy()
      reload()
    })
  })

  function setupSelect (data, useOptgroups) {
    const select = document.getElementById(selectId)
    Object.entries(data).forEach(([optGroupLabel, options]) => {
      let optgroup
      if (useOptgroups) {
        optgroup = document.createElement('optgroup')
        optgroup.setAttribute('label', optGroupLabel)
        select.appendChild(optgroup)
      }

      options.forEach(optionData => {
        const option = document.createElement('option')
        option.innerHTML = optionData.text
        option.setAttribute('value', optionData.value)
        if (optionData.selected) option.setAttribute('selected', optionData.selected)
        if (optionData.subtext) option.setAttribute('data-subtext', optionData.subtext)
        if (optionData.img) option.setAttribute('data-img', JSON.stringify(optionData.img))
        if (optgroup) {
          optgroup.appendChild(option)
        } else {
          select.appendChild(option)
        }
      })
    })
  }

  function reload () {
    new PickMe({
      id: selectId,
      selectedTextFormat: document.getElementById('set_selected_text_format').value,
      language: document.getElementById('set_language').value,
      dropdownAlignRight: document.getElementById('set_dropdown_align_right').checked,
      disabled: document.getElementById('set_disabled').checked,
      withSearch: document.getElementById('search_option').checked,
      multiple: document.getElementById('multiple').checked,
      withSelectAllButton: false,
      selectAllButtonClasses: ['btn', 'btn-default'],
      selectAllButtonGroupClasses: ['btn-group'],
      customDebugHandler: debugHandler,
      debug: true
    })
  }

  function debugHandler (context) {
    try {
      document.getElementById('amount').innerHTML = context.markup.resultsWrapper.querySelectorAll('li').length.toString()
      document.getElementById('value').innerHTML = Object.keys(context.selectedValues).toString()
    } catch (e) {
      console.log(e)
      console.warn('could not show debug')
    }
  }

  document.getElementById('picker').addEventListener('change', function (e) {
    console.log('Picker changed, new value:', e.detail)
  })
</script>
</body>
</html>
