var a=class{element;settings;disabled;wrapper;button;popup;buttonText;searchInput;resultsScrollWrapper;resultsWrapper;hovered;constructor({element:e,settings:t}){this.element=e,this.settings=t,this.disabled=!1,this.wrapper=this.buildWrapper(),this.button=this.buildButton(),this.disabled||(this.popup=this.buildPopup()),this.hideOriginalSelect(),this.assemble()}hideOriginalSelect(){this.element.classList.add("pm__hidden"),this.element.setAttribute("tabindex","-1")}showOriginalSelect(){this.element.classList.remove("pm__hidden"),this.element.removeAttribute("tabindex")}assemble(){if(this.wrapper.appendChild(this.button),!this.disabled)if(this.settings.base.popup.containerSelector){let e=document.querySelector(this.settings.base.popup.containerSelector);e&&(e.appendChild(this.popup),this.popup.style.position="absolute",this.popup.style.top="0")}else this.wrapper.appendChild(this.popup);this.element.parentNode.insertBefore(this.wrapper,this.element)}positionPopup(){if(this.settings.base.popup.containerSelector){let e=this.wrapper.getBoundingClientRect(),t=b(e),s=t.top+this.wrapper.offsetHeight;if(this.shouldDropUp()?this.popup.style.top=(s-this.popup.offsetHeight-this.button.offsetHeight-parseInt(window.getComputedStyle(this.popup).marginTop)).toString()+"px":this.popup.style.top=s.toString()+"px",this.settings.base.popup.alignRight){let i=window.innerWidth-e.left-this.wrapper.offsetWidth;this.popup.style.right=i+"px"}else this.popup.style.left=t.left.toString()+"px";this.popup.style.minWidth=this.wrapper.offsetWidth+"px",this.popup.style.width=this.settings.base.popup.width,this.popup.style.position="absolute"}else this.shouldDropUp()?(this.popup.style.top="auto",this.popup.style.bottom=(this.button.offsetHeight+parseInt(window.getComputedStyle(this.popup).marginTop)).toString()+"px"):(this.popup.style.top="100%",this.popup.style.bottom="auto")}shouldDropUp(){let e=this.button.getBoundingClientRect(),s=b(e).top-document.documentElement.scrollTop,i=window.innerHeight-s-this.button.offsetHeight;return s>i&&i<this.popup.offsetHeight}buildWrapper(){let e=document.createElement("div");return e.classList.add("pick-me"),this.settings.base.multiple&&e.classList.add("pick-me--multiple"),e}buildButton(){let e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("pm__button"),this.settings.button.classList.forEach(t=>{e.classList.add(t)}),this.disabled&&(e.disabled=!0,this.settings.button.disabledClassList.forEach(t=>{e.classList.add(t)})),this.buttonText=document.createElement("span"),this.buttonText.classList.add("pm__button-text"),this.settings.button.iconHtml&&this.settings.button.iconHtml.length>0?(e.appendChild(this.buttonText),e.insertAdjacentHTML("beforeend",this.settings.button.iconHtml)):e.appendChild(this.buttonText),e}buildPopup(){let e=document.createElement("div");return e.classList.add("pm__popup"),this.settings.base.popup.alignRight&&e.classList.add("pm__popup--right"),this.settings.search.enabled&&e.appendChild(this.buildSearchInput()),e.appendChild(this.buildResultsScrollWrapper()),e}buildSearchInput(){let e=document.createElement("div");return e.classList.add("pm__search-input__wrapper"),this.searchInput=document.createElement("input"),this.searchInput.type="search",this.searchInput.setAttribute("placeholder",this.settings.search.input.placeholderText),this.searchInput.classList.add("pm__search-input"),this.settings.search.input.classList.forEach(t=>{this.searchInput.classList.add(t)}),e.appendChild(this.searchInput),e}buildResultsScrollWrapper(){return this.resultsScrollWrapper=document.createElement("div"),this.resultsScrollWrapper.classList.add("pm__results-scroll-wrapper"),this.resultsWrapper=document.createElement("div"),this.resultsWrapper.classList.add("pm__results"),this.resultsWrapper.setAttribute("aria-role","list"),this.resultsScrollWrapper.appendChild(this.resultsWrapper),this.resultsScrollWrapper}renderEntries(e,t,s){if(s.size>0)for(let i of s.keys()){if(i&&i.length>0){let o=document.createElement("span");o.classList.add("pm__opt-group-label"),o.innerText=i,this.resultsWrapper.appendChild(o)}let l=g(this.settings.list.classList);l.setAttribute("data-label",i),this.renderNewEntries(e,t,s.get(i),l),this.resultsWrapper.appendChild(l);let r=document.createElement("hr");r.classList.add("pm__hr"),this.resultsWrapper.appendChild(r)}else{console.log(this.settings.search.noResultsText);let i=f({text:this.settings.search.noResultsText});i.classList.add("pm__results-list__item--muted");let l=g(this.settings.list.classList);l.appendChild(i),this.resultsWrapper.appendChild(l)}}renderNewEntries(e,t,s,i){for(let l of s){let r=e.get(l),o=f({value:l,...r,selected:t.has(l),multiple:this.settings.base.multiple,checkedIconHtml:this.settings.list.checkedIconHtml});i.appendChild(o)}}selectItem(e){let t=this.element.querySelector('option[value="'+e.replaceAll('"','\\"')+'"]');t.selected=!0,t.setAttribute("data-selected",""),this.addSelectedClassByValue(e)}deselectItem(e){let t=this.element.querySelector('option[value="'+e.replaceAll('"','\\"')+'"]');t.selected=!1,t.removeAttribute("data-selected"),this.removeSelectedClassByValue(e)}addSelectedClassByValue(e){let t=this.resultsWrapper.querySelector('li[data-value="'+e.replaceAll('"','\\"')+'"]');t&&h(t,!0,this.settings.base.multiple,this.settings.list.checkedIconHtml)}removeSelectedClassByValue(e){let t=this.resultsWrapper.querySelector('li[data-value="'+e.replaceAll('"','\\"')+'"]');t&&h(t,!1,this.settings.base.multiple,this.settings.list.checkedIconHtml)}destroy(){if(this.showOriginalSelect(),this.settings.base.popup.containerSelector){let e=document.querySelector(this.settings.base.popup.containerSelector);e&&e.removeChild(this.popup)}this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.wrapper)}getSelected(){return this.resultsWrapper.querySelectorAll("li.pm__results-list__item--selected")[0]}focusPreviousEntry(){this.hovered||(this.hovered=this.getSelected());let e=Array.from(this.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]"));if(this.hovered){let t=e.indexOf(this.hovered);t>0&&(this.hovered.classList.remove("pm__results-list__item--hover"),this.hovered=e[t-1],this.hovered.classList.add("pm__results-list__item--hover"),this.scrollEntryIntoView(this.hovered))}else{let t=e[0];if(!t)return;t.classList.add("pm__results-list__item--hover"),this.hovered=t,this.scrollEntryIntoView(t)}}focusNextEntry(){this.hovered||(this.hovered=this.getSelected());let e=Array.from(this.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]"));if(this.hovered){let t=e.indexOf(this.hovered);t<e.length-1&&(this.hovered.classList.remove("pm__results-list__item--hover"),this.hovered=e[t+1],this.hovered.classList.add("pm__results-list__item--hover"),this.scrollEntryIntoView(this.hovered))}else{let t=e[0];if(!t)return;t.classList.add("pm__results-list__item--hover"),this.hovered=t,this.scrollEntryIntoView(t)}}scrollEntryIntoView(e){let t=e.offsetTop-this.resultsScrollWrapper.offsetTop,s=this.resultsScrollWrapper.offsetHeight+this.resultsScrollWrapper.scrollTop<t+e.offsetHeight,i=t<this.resultsScrollWrapper.scrollTop;s?this.resultsScrollWrapper.scrollTop=t-this.resultsScrollWrapper.offsetHeight+e.offsetHeight:i&&(this.resultsScrollWrapper.scrollTop=t)}setButtonText(e){e&&e.size>0?this.buttonText.innerHTML=this.renderButtonText(e):this.buttonText.innerHTML=this.settings.button.placeholderText}renderButtonText(e){if(this.settings.button.selectedText.format){let t=this.settings.button.selectedText.format.match(/count\s?>\s?([0-9]*)/),s=t&&t[1]&&parseInt(t[1]);return s&&s<e.size?this.settings.button.selectedText.text.replace(this.settings.button.selectedText.variable,e.size.toString()):m(e)}else return m(e)}};function m(n){let e=[];for(let t of n.values())e.push(t.text);return e.join(", ")}function g(n){let e=document.createElement("ul");return e.classList.add("pm__results-list"),e.setAttribute("aria-role","listbox"),n.forEach(function(t){e.classList.add(t)}),e}function f(n){let e=n.text,t=n.value,s=n.subtext,i=n.img,l=document.createElement("li"),r=document.createElement("span");if(r.classList.add("pm__results-list__item__text"),r.innerHTML=e,typeof t<"u"&&t!==null&&l.setAttribute("data-value",t),typeof e<"u"&&e!==null&&(l.setAttribute("aria-label",e),l.setAttribute("title",r.innerText)),l.setAttribute("aria-role","listitem"),l.classList.add("pm__results-list__item"),typeof i<"u"&&i!==null){let o=document.createElement("img");Object.keys(i).forEach(function(d){o.setAttribute(d,i[d])}),o.classList.add("pm__results-list__item__image"),l.appendChild(o)}if(l.appendChild(r),typeof s<"u"&&s!==null){let o=document.createElement("small");o.innerHTML=s,o.classList.add("pm__results-list__item__subtext"),l.appendChild(o)}return n.selected&&h(l,!0,n.multiple,n.checkedIconHtml),l}function h(n,e,t,s){if(e)if(t){let i=document.createElement("span");i.classList.add("pm__results-list__item__check-mark"),n.appendChild(i),i.insertAdjacentHTML("beforeend",s)}else n.classList.remove("pm__results-list__item--hover"),n.classList.add("pm__results-list__item--selected");else if(t){let i=n.querySelector(".pm__results-list__item__check-mark");i&&n.removeChild(i)}else n.classList.remove("pm__results-list__item--selected")}function b(n){let e=document.documentElement;return{top:n.top+(window.pageYOffset||e.scrollTop)-(e.clientTop||0),left:n.left+(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}}var v={searchPlaceholder:"Suchen",emptySelectButtonText:"Alle anzeigen",noResultsText:"Keine Ergebnisse gefunden",selectedText:"%num% Eintr\xE4ge ausgew\xE4hlt",selectAllButtonText:"Alles ausw\xE4hlen",deselectAllButtonText:"Nichts ausw\xE4hlen"};var L={searchPlaceholder:"Search",emptySelectButtonText:"Show all",noResultsText:"No results found",selectedText:"%num% selected",selectAllButtonText:"Select all",deselectAllButtonText:"Deselect all"};var _={de:v,en:L},u=_;var p=class{element;base;language;search;button;list;selectAll;constructor(e){this.element=document.getElementById(e.id),this.setBase(e.base),this.setLanguage(e.language),this.setSearch(e.search),this.setButton(e.button),this.setList(e.list)}setBase(e){this.base={},this.base.multiple=!!this.element.multiple||!!e?.multiple,this.base.debug=e.debug,this.base.popup={},this.base.popup.containerSelector=e?.popup?.containerSelector,this.base.popup.alignRight=e?.popup?.alignRight,this.base.popup.width=e?.popup?.width||"300px"}setLanguage(e){this.language={},this.language.locale=e?.locale||document.documentElement.lang||"en",this.language.i18n=e?.i18n||u[e?.locale]||u.en}setSearch(e){this.search={},this.search.enabled=!!e?.enabled,this.search.debounce=e?.debounce||50,this.search.input={},this.search.input.placeholderText=e?.input?.placeholderText||this.language.i18n?.searchPlaceholder||"Search",this.search.input.classList=e?.input?.classList||[],this.search.noResultsText=e?.noResultsText||this.language.i18n.noResultsText||"No results"}setButton(e){this.button={},this.button.placeholderText=e?.placeholderText||this.language.i18n?.emptySelectButtonText||"Select",this.button.classList=e?.classList||[],this.button.disabledClassList=e?.disabledClassList||[],this.button.iconHtml=e?.iconHtml||"\u2BC6",this.button.selectedText={},this.button.selectedText.format=e?.selectedText?.format,this.button.selectedText.variable=e?.selectedText?.variable||"%num%",this.button.selectedText.text=e?.selectedText?.text||this.language.i18n?.selectedText||"%num% selected"}setList(e){this.list={},this.list.checkedIconHtml=e?.checkedIconHtml||"\u2713",this.list.classList=e?.classList||[]}};var c=class{id;element;label;settings;initialSelectedValues;open;handlers;ui;options;searchInputTimer;constructor(e){return this.id=e.id,this.element=document.getElementById(this.id),this.label=document.querySelector('label[for="'+this.id+'"]'),this.settings=new p(e),this.initialSelectedValues=[],this.open=!1,this.handlers={},this.initialize(),this.logDebugMessage("initialized with options:",this.settings),this}initialize(){this.setupInitialValues(),this.ui=this.buildMarkup(),this.addHandlers(),this.addEvents(),this.setupValues(),this.ui.renderEntries(this.options.all,this.options.selected,this.options.optgroups),this.addEventListenersForPage(),this.ui.setButtonText(this.options.selected)}setupInitialValues(){this.element.querySelectorAll("option[selected]").forEach(t=>this.initialSelectedValues.push(t.value))}addHandlers(){this.handlers.closePopupHandler=e=>this.closePopup(e),this.handlers.selectHandler=e=>this.select(e),this.handlers.containerPositionHandler=()=>this.ui.positionPopup(),this.handlers.resetFormHandler=()=>this.resetAndReload(),this.handlers.labelClickHandler=e=>{e.preventDefault(),this.ui.button.focus()}}addEvents(){this.ui.button.addEventListener("click",()=>this.togglePopup()),this.ui.popup.addEventListener("click",e=>e.stopPropagation()),this.settings.search.enabled?(this.ui.searchInput.addEventListener("input",()=>this.search()),this.ui.button.addEventListener("keydown",e=>this.onButtonKeyDown(e)),this.ui.popup.addEventListener("keydown",e=>this.onMarkupKeyDown(e))):this.ui.button.addEventListener("keydown",e=>this.onMarkupKeyDown(e)),document.addEventListener("click",this.handlers.closePopupHandler),window.addEventListener("resize",this.handlers.containerPositionHandler),window.addEventListener("scroll",this.handlers.containerPositionHandler),this.label&&this.label.addEventListener("click",this.handlers.labelClickHandler),this.element.form&&this.element.form.addEventListener("reset",this.handlers.resetFormHandler),S(this.ui.element,this.destroy.bind(this))}setupValues(){this.options={all:new Map,selected:new Map,optgroups:new Map},Array(...this.element.options).forEach(e=>{let t=e.parentNode,s=t.nodeName==="OPTGROUP"?t.label:"";this.options.optgroups.has(s)||this.options.optgroups.set(s,[]);let i={text:e.innerHTML,subtext:e.getAttribute("data-subtext"),img:JSON.parse(e.getAttribute("data-img")),searchData:e.innerText.toLowerCase().trim()};this.options.all.set(e.value,i),this.options.optgroups.get(s).push(e.value),(e.selected||e.hasAttribute("selected"))&&(this.options.selected.set(e.value,i),e.setAttribute("data-selected","true"))})}buildMarkup(){return new a({element:this.element,settings:this.settings})}resetAndReload(){this.logDebugMessage("form reset! reloading pick-me"),this.reload()}onButtonKeyDown(e){e.keyCode===13&&(e.preventDefault(),this.togglePopup(e))}onMarkupKeyDown(e){if(e.keyCode===9||e.keyCode===27)this.closePopupAndFocus(e);else if(e.keyCode===40)e.preventDefault(),this.ui.focusNextEntry();else if(e.keyCode===38)e.preventDefault(),this.ui.focusPreviousEntry();else if(e.keyCode===13)if(e.preventDefault(),this.open){let t=this.ui.hovered;t&&this.select({currentTarget:t})}else this.openPopup()}removeEvents(){document.removeEventListener("click",this.handlers.closePopupHandler),window.removeEventListener("resize",this.handlers.containerPositionHandler),window.removeEventListener("scroll",this.handlers.containerPositionHandler),this.label&&this.label.removeEventListener("click",this.handlers.labelClickHandler),this.element.form&&this.element.form.removeEventListener("reset",this.handlers.resetFormHandler)}togglePopup(e){this.open?this.closePopupAndFocus(e):this.openPopup()}search(){this.searchInputTimer&&clearTimeout(this.searchInputTimer),this.ui.hovered&&this.ui.hovered.classList.remove("pm__results-list__item--hover"),this.ui.hovered=null,this.searchInputTimer=setTimeout(()=>{this.doSearch()},this.settings.search.debounce)}doSearch(){let t=this.ui.searchInput.value.toLowerCase(),s=new Map;for(let[i,l]of this.options.optgroups)for(let r of l)this.options.all.get(r).searchData.includes(t)&&(s.get(i)||s.set(i,[]),s.get(i).push(r));this.ui.resultsWrapper.innerHTML="",this.ui.renderEntries(this.options.all,this.options.selected,s),this.addEventListenersForPage()}openPopup(){this.ui.popup.classList.add("pm__popup--visible"),this.open=!0,this.ui.positionPopup(),this.settings.search.enabled&&this.ui.searchInput.focus()}closePopup(e){let t=e?.target,s=e&&(t===this.ui.button||t?.parentElement===this.ui.button);this.open&&!s&&(this.ui.popup.classList.remove("pm__popup--visible"),this.open=!1,this.ui.hovered&&this.ui.hovered.classList.remove("pm__results-list__item--hover"),this.ui.hovered=null,this.settings.search.enabled&&this.resetSearch())}closePopupAndFocus(e){this.closePopup(e),this.ui.button.focus()}addEventListenersForPage(){Array(...this.ui.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]:not(.pm__results-list__item--disabled)")).forEach(e=>{e.addEventListener("click",this.handlers.selectHandler)})}select(e){let s=e.currentTarget.getAttribute("data-value"),i=this.options.all.get(s);this.settings.base.multiple?this.toggleSelectedValue(s,i):this.setSelectedValue(s,i),this.ui.setButtonText(this.options.selected),this.settings.base.multiple||this.closePopupAndFocus(e),this.triggerChange()}triggerChange(){this.element.dispatchEvent(new CustomEvent("change",{detail:this.options.selected}))}toggleSelectedValue(e,t){this.options.selected.get(e)?this.removeSelectedValue(e):this.addSelectedValue(e,t)}addSelectedValue(e,t){this.options.selected.set(e,t),this.ui.selectItem(e),this.settings.search.enabled&&this.ui.searchInput.focus()}removeSelectedValue(e){this.options.selected.delete(e),this.ui.deselectItem(e)}setSelectedValue(e,t){if(this.options.selected.size>0){this.removeSelectedValue(this.options.selected.entries().next().value[0]);let s=this.ui.getSelected();s&&s.classList.remove("pm__results-list__item--selected")}this.addSelectedValue(e,t)}logDebugMessage(e,t){this.settings.base.debug&&(e&&console.log("PickMe#"+this.id,e),t&&console.log(t))}resetSearch(){this.ui.searchInput.value="",this.search()}destroy(){this.removeEvents(),this.ui.destroy(),this.options=null,delete this.ui,this.element.classList.remove("pm__hidden")}reload(){for(let e of this.options.selected.keys())this.ui.deselectItem(e);this.destroy(),this.initialSelectedValues.forEach(e=>{let t=this.element.querySelector('option[value="'+e.replaceAll('"','\\"')+'"]');t.selected=!0}),this.initialize()}};function S(n,e){let t=new MutationObserver(function(){function s(i){return i.parentNode===document?!1:i.parentNode===null?!0:s(i.parentNode)}s(n)&&(t.disconnect(),e())});t.observe(document,{childList:!0,subtree:!0})}export{c as default};
//# sourceMappingURL=pick-me.min.js.map
