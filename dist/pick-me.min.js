var a=class{element;settings;disabled;wrapper;button;popup;buttonText;buttonLabel;searchInput;resultsScrollWrapper;resultsWrapper;hovered;constructor({element:t,settings:e}){this.element=t,this.settings=e,this.disabled=!1,this.wrapper=this.buildWrapper(),this.button=this.buildButton(),this.disabled||(this.popup=this.buildPopup()),this.hideOriginalSelect(),this.assemble()}hideOriginalSelect(){this.element.classList.add("pm__hidden"),this.element.setAttribute("tabindex","-1")}showOriginalSelect(){this.element.classList.remove("pm__hidden"),this.element.removeAttribute("tabindex")}assemble(){if(this.wrapper.appendChild(this.button),!this.disabled)if(this.settings.base.popup.containerSelector){let t=document.querySelector(this.settings.base.popup.containerSelector);t&&(t.appendChild(this.popup),this.popup.style.position="absolute",this.popup.style.top="0")}else this.wrapper.appendChild(this.popup);this.element.parentNode.insertBefore(this.wrapper,this.element)}positionPopup(){if(this.settings.base.popup.containerSelector){let t=this.wrapper.getBoundingClientRect(),e=f(t),s=e.top+this.wrapper.offsetHeight;if(this.shouldDropUp()?this.popup.style.top=(s-this.popup.offsetHeight-this.button.offsetHeight-parseInt(window.getComputedStyle(this.popup).marginTop)).toString()+"px":this.popup.style.top=s.toString()+"px",this.settings.base.popup.alignRight){let i=window.innerWidth-t.left-this.wrapper.offsetWidth;this.popup.style.right=i+"px"}else this.popup.style.left=e.left.toString()+"px";this.popup.style.minWidth=this.wrapper.offsetWidth+"px",this.popup.style.width=this.settings.base.popup.width,this.popup.style.position="absolute"}else this.shouldDropUp()?(this.popup.style.top="auto",this.popup.style.bottom=(this.button.offsetHeight+parseInt(window.getComputedStyle(this.popup).marginTop)).toString()+"px"):(this.popup.style.top="100%",this.popup.style.bottom="auto")}shouldDropUp(){let t=this.button.getBoundingClientRect(),s=f(t).top-document.documentElement.scrollTop,i=window.innerHeight-s-this.button.offsetHeight;return s>i&&i<this.popup.offsetHeight}buildWrapper(){let t=document.createElement("div");return t.classList.add("pick-me"),this.settings.base.multiple&&t.classList.add("pick-me--multiple"),t}buildButton(){let t=document.createElement("button");if(t.setAttribute("type","button"),t.classList.add("pm__button"),this.settings.button.classList.forEach(e=>{t.classList.add(e)}),this.disabled&&(t.disabled=!0,this.settings.button.disabledClassList.forEach(e=>{t.classList.add(e)})),this.buttonText=document.createElement("span"),this.buttonText.classList.add("pm__button-text"),this.settings.button.labelText?.length>0&&(this.buttonLabel=document.createElement("span"),this.buttonLabel.classList.add("pm__button-label"),this.buttonLabel.innerText=this.settings.button.labelText,t.appendChild(this.buttonLabel)),t.appendChild(this.buttonText),this.settings.button.iconHtml&&this.settings.button.iconHtml.length>0){let e=document.createElement("span");e.classList.add("pm__icon-wrapper"),e.insertAdjacentHTML("beforeend",this.settings.button.iconHtml),t.appendChild(e)}return t}buildPopup(){let t=document.createElement("div");return t.classList.add("pm__popup"),this.settings.base.popup.alignRight&&t.classList.add("pm__popup--right"),this.settings.search.enabled&&t.appendChild(this.buildSearchInput()),t.appendChild(this.buildResultsScrollWrapper()),t}buildSearchInput(){let t=document.createElement("div");return t.classList.add("pm__search-input__wrapper"),this.searchInput=document.createElement("input"),this.searchInput.type="search",this.searchInput.setAttribute("placeholder",this.settings.search.input.placeholderText),this.searchInput.classList.add("pm__search-input"),this.settings.search.input.classList.forEach(e=>{this.searchInput.classList.add(e)}),t.appendChild(this.searchInput),t}buildResultsScrollWrapper(){return this.resultsScrollWrapper=document.createElement("div"),this.resultsScrollWrapper.classList.add("pm__results-scroll-wrapper"),this.resultsWrapper=document.createElement("div"),this.resultsWrapper.classList.add("pm__results"),this.resultsWrapper.setAttribute("aria-role","list"),this.resultsScrollWrapper.appendChild(this.resultsWrapper),this.resultsScrollWrapper}renderEntries(t,e,s){if(s.size>0){let i=0;for(let n of s.keys()){if(i=i+1,n&&n.length>0){let o=document.createElement("span");o.classList.add("pm__opt-group-label"),o.innerText=n,this.resultsWrapper.appendChild(o)}let r=g(this.settings.list.classList);if(r.setAttribute("data-label",n),this.renderNewEntries(t,e,s.get(n),r),this.resultsWrapper.appendChild(r),n&&n.length>0&&i<s.size){let o=document.createElement("hr");o.classList.add("pm__hr"),this.resultsWrapper.appendChild(o)}}}else{let i=b({text:this.settings.search.noResultsText});i.classList.add("pm__results-list__item--muted");let n=g(this.settings.list.classList);n.appendChild(i),this.resultsWrapper.appendChild(n)}}renderNewEntries(t,e,s,i){for(let n of s){let r=t.get(n),o=b({value:n,...r,selected:e.has(n),multiple:this.settings.base.multiple,checkedIconHtml:this.settings.list.checkedIconHtml});i.appendChild(o)}}selectItem(t){let e=this.element.querySelector('option[value="'+t.replaceAll('"','\\"')+'"]');e.selected=!0,e.setAttribute("data-selected",""),this.addSelectedClassByValue(t)}deselectItem(t){let e=this.element.querySelector('option[value="'+t.replaceAll('"','\\"')+'"]');e.selected=!1,e.removeAttribute("data-selected"),this.removeSelectedClassByValue(t)}addSelectedClassByValue(t){let e=this.resultsWrapper.querySelector('li[data-value="'+t.replaceAll('"','\\"')+'"]');e&&h(e,!0,this.settings.base.multiple,this.settings.list.checkedIconHtml)}removeSelectedClassByValue(t){let e=this.resultsWrapper.querySelector('li[data-value="'+t.replaceAll('"','\\"')+'"]');e&&h(e,!1,this.settings.base.multiple,this.settings.list.checkedIconHtml)}destroy(){if(this.showOriginalSelect(),this.settings.base.popup.containerSelector){let t=document.querySelector(this.settings.base.popup.containerSelector);t&&t.removeChild(this.popup)}this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.wrapper)}getSelected(){return this.resultsWrapper.querySelectorAll("li.pm__results-list__item--selected")[0]}focusPreviousEntry(){this.hovered||(this.hovered=this.getSelected());let t=Array.from(this.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]"));if(this.hovered){let e=t.indexOf(this.hovered);e>0&&(this.hovered.classList.remove("pm__results-list__item--hover"),this.hovered=t[e-1],this.hovered.classList.add("pm__results-list__item--hover"),this.scrollEntryIntoView(this.hovered))}else{let e=t[0];if(!e)return;e.classList.add("pm__results-list__item--hover"),this.hovered=e,this.scrollEntryIntoView(e)}}focusNextEntry(){this.hovered||(this.hovered=this.getSelected());let t=Array.from(this.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]"));if(this.hovered){let e=t.indexOf(this.hovered);e<t.length-1&&(this.hovered.classList.remove("pm__results-list__item--hover"),this.hovered=t[e+1],this.hovered.classList.add("pm__results-list__item--hover"),this.scrollEntryIntoView(this.hovered))}else{let e=t[0];if(!e)return;e.classList.add("pm__results-list__item--hover"),this.hovered=e,this.scrollEntryIntoView(e)}}scrollEntryIntoView(t){let e=t.offsetTop-this.resultsScrollWrapper.offsetTop,s=this.resultsScrollWrapper.offsetHeight+this.resultsScrollWrapper.scrollTop<e+t.offsetHeight,i=e<this.resultsScrollWrapper.scrollTop;s?this.resultsScrollWrapper.scrollTop=e-this.resultsScrollWrapper.offsetHeight+t.offsetHeight:i&&(this.resultsScrollWrapper.scrollTop=e)}setButtonText(t){t&&t.size>0?this.buttonText.innerHTML=this.renderButtonText(t):this.buttonText.innerHTML=this.settings.button.placeholderText}renderButtonText(t){if(this.settings.button.selectedText.format){let e=this.settings.button.selectedText.format.match(/count\s?>\s?([0-9]*)/),s=e&&e[1]&&parseInt(e[1]);return s&&s<t.size?this.settings.button.selectedText.text.replace(this.settings.button.selectedText.variable,t.size.toString()):m(t)}else return m(t)}};function m(l){let t=[];for(let e of l.values())t.push(e.text);return t.join(", ")}function g(l){let t=document.createElement("ul");return t.classList.add("pm__results-list"),t.setAttribute("aria-role","listbox"),l.forEach(function(e){t.classList.add(e)}),t}function b(l){let t=l.text,e=l.value,s=l.subtext,i=l.img,n=document.createElement("li"),r=document.createElement("span");if(r.classList.add("pm__results-list__item__text"),r.innerHTML=t,typeof e<"u"&&e!==null&&n.setAttribute("data-value",e),typeof t<"u"&&t!==null&&(n.setAttribute("aria-label",t),n.setAttribute("title",r.innerText)),n.setAttribute("aria-role","listitem"),n.classList.add("pm__results-list__item"),typeof i<"u"&&i!==null){let o=document.createElement("img");Object.keys(i).forEach(function(d){o.setAttribute(d,i[d])}),o.classList.add("pm__results-list__item__image"),n.appendChild(o)}if(n.appendChild(r),typeof s<"u"&&s!==null){let o=document.createElement("small");o.innerHTML=s,o.classList.add("pm__results-list__item__subtext"),n.appendChild(o)}return l.selected&&h(n,!0,l.multiple,l.checkedIconHtml),n}function h(l,t,e,s){if(t)if(e){let i=document.createElement("span");i.classList.add("pm__results-list__item__check-mark"),l.appendChild(i),i.insertAdjacentHTML("beforeend",s)}else l.classList.remove("pm__results-list__item--hover"),l.classList.add("pm__results-list__item--selected");else if(e){let i=l.querySelector(".pm__results-list__item__check-mark");i&&l.removeChild(i)}else l.classList.remove("pm__results-list__item--selected")}function f(l){let t=document.documentElement;return{top:l.top+(window.pageYOffset||t.scrollTop)-(t.clientTop||0),left:l.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}}var L={search:{input:{placeholderText:"Suchen"},noResultsText:"Keine Ergebnisse gefunden"},button:{placeholderText:"Bitte w\xE4hlen",labelText:"Eintrag",selectedText:{text:"%num% Eintr\xE4ge ausgew\xE4hlt"}}};var v={search:{input:{placeholderText:"Search"},noResultsText:"No results found"},button:{placeholderText:"Chose",labelText:"Entry",selectedText:{text:"%num% selected"}}};var _={de:L,en:v},u=_;var p=class{element;base;language;search;button;list;selectAll;constructor(t){this.element=document.getElementById(t.id),this.setBase(t.base),this.setLanguage(t.language),this.setSearch(t.search),this.setButton(t.button),this.setList(t.list)}setBase(t){this.base={},this.base.multiple=!!this.element.multiple||!!t?.multiple,this.base.debug=t.debug,this.base.popup={},this.base.popup.containerSelector=t?.popup?.containerSelector,this.base.popup.alignRight=t?.popup?.alignRight,this.base.popup.width=t?.popup?.width||"300px"}setLanguage(t){this.language={},this.language.locale=t?.locale||document.documentElement.lang||"en",this.language.i18n=t?.i18n||u[t?.locale]||u.en}setSearch(t){this.search={},this.search.enabled=!!t?.enabled,this.search.debounce=t?.debounce||50,this.search.input={},this.search.input.placeholderText=t?.input?.placeholderText||this.language.i18n?.search?.input?.placeholderText||"Search",this.search.input.classList=t?.input?.classList||[],this.search.noResultsText=t?.noResultsText||this.language.i18n?.search?.noResultsText||"No results"}setButton(t){this.button={},this.button.placeholderText=t?.placeholderText||this.language.i18n?.button?.placeholderText||"Select",this.button.labelText=t?.labelText,this.button.classList=t?.classList||[],this.button.disabledClassList=t?.disabledClassList||[],this.button.iconHtml=t?.iconHtml||"\u2BC6",this.button.selectedText={},this.button.selectedText.format=t?.selectedText?.format,this.button.selectedText.variable=t?.selectedText?.variable||"%num%",this.button.selectedText.text=t?.selectedText?.text||this.language.i18n?.button?.selectedText?.text||"%num% selected"}setList(t){this.list={},this.list.checkedIconHtml=t?.checkedIconHtml||"\u2713",this.list.classList=t?.classList||[]}};var c=class{id;element;label;settings;initialSelectedValues;open;handlers;ui;options;searchInputTimer;constructor(t){return this.id=t.id,this.element=document.getElementById(this.id),this.label=document.querySelector('label[for="'+this.id+'"]'),this.settings=new p(t),this.initialSelectedValues=[],this.open=!1,this.handlers={},this.initialize(),this.logDebugMessage("initialized with options:",this.settings),this}initialize(){this.setupInitialValues(),this.ui=this.buildMarkup(),this.addHandlers(),this.addEvents(),this.setupValues(),this.ui.renderEntries(this.options.all,this.options.selected,this.options.optgroups),this.addEventListenersForPage(),this.ui.setButtonText(this.options.selected)}setupInitialValues(){this.element.querySelectorAll("option[selected]").forEach(e=>this.initialSelectedValues.push(e.value))}addHandlers(){this.handlers.closePopupHandler=t=>this.closePopup(t),this.handlers.selectHandler=t=>this.select(t),this.handlers.containerPositionHandler=()=>this.ui.positionPopup(),this.handlers.resetFormHandler=()=>this.resetAndReload(),this.handlers.labelClickHandler=t=>{t.preventDefault(),this.ui.button.focus()}}addEvents(){this.ui.button.addEventListener("click",()=>this.togglePopup()),this.ui.popup.addEventListener("click",t=>t.stopPropagation()),this.settings.search.enabled?(this.ui.searchInput.addEventListener("input",()=>this.search()),this.ui.button.addEventListener("keydown",t=>this.onButtonKeyDown(t)),this.ui.popup.addEventListener("keydown",t=>this.onMarkupKeyDown(t))):this.ui.button.addEventListener("keydown",t=>this.onMarkupKeyDown(t)),document.addEventListener("click",this.handlers.closePopupHandler),window.addEventListener("resize",this.handlers.containerPositionHandler),window.addEventListener("scroll",this.handlers.containerPositionHandler),this.label&&this.label.addEventListener("click",this.handlers.labelClickHandler),this.element.form&&this.element.form.addEventListener("reset",this.handlers.resetFormHandler),S(this.ui.element,this.destroy.bind(this))}setupValues(){this.options={all:new Map,selected:new Map,optgroups:new Map},Array(...this.element.options).forEach(t=>{let e=t.parentNode,s=e.nodeName==="OPTGROUP"?e.label:"";this.options.optgroups.has(s)||this.options.optgroups.set(s,[]);let i={text:t.innerHTML,subtext:t.getAttribute("data-subtext"),img:JSON.parse(t.getAttribute("data-img")),searchData:t.innerText.toLowerCase().trim()};this.options.all.set(t.value,i),this.options.optgroups.get(s).push(t.value),(t.selected||t.hasAttribute("selected"))&&(this.options.selected.set(t.value,i),t.setAttribute("data-selected","true"))})}buildMarkup(){return new a({element:this.element,settings:this.settings})}resetAndReload(){this.logDebugMessage("form reset! reloading pick-me"),this.reload()}onButtonKeyDown(t){t.keyCode===13&&(t.preventDefault(),this.togglePopup(t))}onMarkupKeyDown(t){if(t.keyCode===9||t.keyCode===27)this.closePopupAndFocus(t);else if(t.keyCode===40)t.preventDefault(),this.ui.focusNextEntry();else if(t.keyCode===38)t.preventDefault(),this.ui.focusPreviousEntry();else if(t.keyCode===13)if(t.preventDefault(),this.open){let e=this.ui.hovered;e&&this.select({currentTarget:e})}else this.openPopup()}removeEvents(){document.removeEventListener("click",this.handlers.closePopupHandler),window.removeEventListener("resize",this.handlers.containerPositionHandler),window.removeEventListener("scroll",this.handlers.containerPositionHandler),this.label&&this.label.removeEventListener("click",this.handlers.labelClickHandler),this.element.form&&this.element.form.removeEventListener("reset",this.handlers.resetFormHandler)}togglePopup(t){this.open?this.closePopupAndFocus(t):this.openPopup()}search(){this.searchInputTimer&&clearTimeout(this.searchInputTimer),this.ui.hovered&&this.ui.hovered.classList.remove("pm__results-list__item--hover"),this.ui.hovered=null,this.searchInputTimer=setTimeout(()=>{this.doSearch()},this.settings.search.debounce)}doSearch(){let e=this.ui.searchInput.value.toLowerCase(),s=new Map;for(let[i,n]of this.options.optgroups)for(let r of n)this.options.all.get(r).searchData.includes(e)&&(s.get(i)||s.set(i,[]),s.get(i).push(r));this.ui.resultsWrapper.innerHTML="",this.ui.renderEntries(this.options.all,this.options.selected,s),this.addEventListenersForPage()}openPopup(){this.ui.popup.classList.add("pm__popup--visible"),this.open=!0,this.ui.positionPopup(),this.settings.search.enabled&&this.ui.searchInput.focus()}closePopup(t){let e=t?.target,s=t&&(e===this.ui.button||e?.parentElement===this.ui.button);this.open&&!s&&(this.ui.popup.classList.remove("pm__popup--visible"),this.open=!1,this.ui.hovered&&this.ui.hovered.classList.remove("pm__results-list__item--hover"),this.ui.hovered=null,this.settings.search.enabled&&this.resetSearch())}closePopupAndFocus(t){this.closePopup(t),this.ui.button.focus()}addEventListenersForPage(){Array(...this.ui.resultsWrapper.querySelectorAll("li.pm__results-list__item[data-value]:not(.pm__results-list__item--disabled)")).forEach(t=>{t.addEventListener("click",this.handlers.selectHandler)})}select(t){let s=t.currentTarget.getAttribute("data-value"),i=this.options.all.get(s);this.settings.base.multiple?this.toggleSelectedValue(s,i):this.setSelectedValue(s,i),this.ui.setButtonText(this.options.selected),this.settings.base.multiple||this.closePopupAndFocus(t),this.triggerChange()}triggerChange(){this.element.dispatchEvent(new CustomEvent("change",{detail:this.options.selected}))}toggleSelectedValue(t,e){this.options.selected.get(t)?this.removeSelectedValue(t):this.addSelectedValue(t,e)}addSelectedValue(t,e){this.options.selected.set(t,e),this.ui.selectItem(t),this.settings.search.enabled&&this.ui.searchInput.focus()}removeSelectedValue(t){this.options.selected.delete(t),this.ui.deselectItem(t)}setSelectedValue(t,e){if(this.options.selected.size>0){this.removeSelectedValue(this.options.selected.entries().next().value[0]);let s=this.ui.getSelected();s&&s.classList.remove("pm__results-list__item--selected")}this.addSelectedValue(t,e)}logDebugMessage(t,e){this.settings.base.debug&&(t&&console.log("PickMe#"+this.id,t),e&&console.log(e))}resetSearch(){this.ui.searchInput.value="",this.search()}destroy(){this.removeEvents(),this.ui.destroy(),this.options=null,delete this.ui,this.element.classList.remove("pm__hidden")}reload(){for(let t of this.options.selected.keys())this.ui.deselectItem(t);this.destroy(),this.initialSelectedValues.forEach(t=>{let e=this.element.querySelector('option[value="'+t.replaceAll('"','\\"')+'"]');e.selected=!0}),this.initialize()}};function S(l,t){let e=new MutationObserver(function(){function s(i){return i.parentNode===document?!1:i.parentNode===null?!0:s(i.parentNode)}s(l)&&(e.disconnect(),t())});e.observe(document,{childList:!0,subtree:!0})}export{c as default};
//# sourceMappingURL=pick-me.min.js.map
